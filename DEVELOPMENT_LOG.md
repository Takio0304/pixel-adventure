# 開発ログ

このファイルは、ゲーム開発における会話と決定事項を記録します。

## 2025-06-23

### プロジェクト開始
- **決定**: スーパーマリオのような横スクロールアクションゲームを作成
- **技術選定**: Phaser.js 3.xを使用
- **ディレクトリ**: `/home/takio/game-project`を作成

### 要件定義
- **アプローチ**: 要件定義からじっくりと行うことに決定
- **成果物**: `REQUIREMENTS.md`を作成
  - ゲーム名：「ピクセルアドベンチャー」（仮）
  - 4ワールド×4ステージ構成
  - 基本操作：移動、ジャンプ、ダッシュ、しゃがみ
  - パワーアップシステム：キノコ、スター、ファイアフラワー
  - 開発フェーズを4段階に分割（計11週間想定）

### 開発管理
- **ログ管理**: `DEVELOPMENT_LOG.md`（このファイル）で会話と決定事項を記録することに決定

---

## 今後の議論事項

### コース構成の変更（ユーザー要件）
- **要件**: コースは全部で3つ作成
- **実装**: メインメニューから選択可能
- **変更前**: 4ワールド×4ステージ（計16ステージ）
- **変更後**: 3コース構成（各1ステージ）

### コース詳細の決定
- **各コースのステージ数**: 1ステージずつ（計3ステージ）
- **コーステーマ**:
  - コース1: 普通（草原・青空、マリオ1-1風）
  - コース2: 洞窟
  - コース3: 城
- **難易度**: 全コース共通（ゲーム中級者向け）

### アイテムシステムの詳細検討
- **質問**: アイテムの入手方法と種類について
- **現在の要件**: 
  - パワーアップ：キノコ、スター、ファイアフラワー
  - 収集：コイン、特別なコイン
- **決定**: 現在のアイテム種類で確定
- **入手方法**: 
  - ？ブロックから出現
  - 隠しブロック
  - 敵のドロップ
  - ステージ配置
  - 連続アクションボーナス

### キャラクターデザインの検討
- **質問**: キャラクターデザインについて
- **CHARACTER_DESIGN.md**作成: デザインオプションを提示
- **決定**: プレイヤーキャラクターは歩行型の敵キャラクターデザインを採用
  - 候補: キノコ型、スライム型、機械型の歩行キャラクター
- **最終決定**: キノコ型キャラクターに決定

### アニメーションシステムの確認
- **質問**: キャラクターアニメーションの実装について
- **追加質問**: ゴール後のアニメーションについて
- **決定**: ゴールアニメーションを追加
  - 3回ジャンプ
  - 傘を回転
  - 決めポーズ
- **追加**: ダッシュアニメーションも仕様に追加

### 開発上の懸念点の検討

#### 1. ゲームの長さとステージ設計
- **各ステージの長さ**: 3-5分程度でクリア可能
- **総プレイ時間**: 初回プレイで15-20分程度
- **リプレイ性**: 
  - タイムアタック要素
  - 隠しアイテム収集（各ステージ3つの特別なコイン）
  - ベストスコアの更新

#### 2. 難易度調整
- **中級者の定義**: 
  - 2Dアクションゲーム経験者
  - 精密なジャンプ操作ができる
  - パターン学習で攻略可能
- **チェックポイント**: 
  - 各ステージ中間地点に1つ設置
  - 旗やゲートで視覚的に分かりやすく
- **ライフシステム**: 
  - ミスしても即ゲームオーバーにならない
  - チェックポイントから再開

#### 3. 操作性
- **対応入力**:
  - キーボード：メイン（矢印キー + スペース + Shift）
  - ゲームパッド：対応予定（Gamepad API使用）
  - モバイル：将来的に検討（画面タッチボタン）
- **操作設定**: キーコンフィグ機能を実装

#### 4. 音響素材
- **調達方法**: 
  - 効果音：フリー素材サイト（効果音ラボ、魔王魂など）
  - BGM：フリーBGMサイトまたはAI生成ツール
- **必要な音源リスト**:
  - BGM：メニュー、草原、洞窟、城（各1曲）
  - 効果音：ジャンプ、着地、コイン、パワーアップ、ダメージ、敵撃破、ゴール

#### 5. セーブ機能
- **保存データ**:
  - 各ステージのハイスコア
  - ベストタイム
  - 収集した特別なコインの状況
- **保存方法**: ブラウザのLocalStorage使用
- **データ形式**: JSON形式で保存

#### 6. パフォーマンス最適化
- **スプライト管理**:
  - 画面外のオブジェクトは処理を軽減
  - オブジェクトプールで再利用
- **洞窟ステージの視界制限**:
  - シンプルな円形グラデーションマスク
  - 重い処理は避ける
- **目標FPS**: 60fps維持（低スペックPCでも30fps以上）

## 実装開始

### プロジェクトセットアップ完了
- **npm初期化**: package.json作成
- **依存関係インストール**: 
  - Phaser.js 3.70.0
  - Vite（開発サーバー）
- **ディレクトリ構造**:
  - src/scenes/: シーンファイル
  - src/sprites/: スプライトクラス
  - src/config/: 設定ファイル

### 基本実装完了
- **index.html**: ゲームコンテナとローディング画面
- **main.js**: Phaser初期化とゲーム設定
- **MenuScene.js**: メインメニュー画面
- **StageSelectScene.js**: ステージ選択画面
- **GameScene.js**: ゲームプレイ画面（基本的な移動とジャンプ）
- **gameConfig.js**: ゲーム設定値の定義

### 現在の機能
- メニューナビゲーション
- ステージ選択
- プレイヤーの左右移動
- ジャンプ機能
- ダッシュ機能（Shift）
- しゃがみ機能（下キー）

### キノコスプライト実装完了
- **Player.js**: プレイヤークラスの作成
- **spriteGenerator.js**: キノコのスプライト生成
- **アニメーション**:
  - 待機（2フレーム）
  - 歩行（4フレーム）
  - ジャンプ（1フレーム）
  - しゃがみ（1フレーム）

### ブロックシステム実装
- **blockGenerator.js**: ブロックテクスチャ生成
- **ブロックタイプ**:
  - レンガブロック（草原）
  - 石ブロック（洞窟）
  - 城ブロック（城）
  - ？ブロック（アイテム出現）
  - 土管
- **プラットフォーム配置**: 各ステージに足場を配置
- **？ブロック機能**: 下から叩くとアイテム出現（実装準備済み）

### 敵キャラクター実装完了
- **enemyGenerator.js**: 敵スプライト生成
- **Enemy.js**: 敵クラスの実装
- **敵タイプ**:
  - 歩行型（茶色いキノコ）
  - 飛行型（コウモリ）
  - 追跡型（ゴースト）
- **敵の挙動**:
  - 歩行型: 左右に往復
  - 飛行型: 波状に飛行
  - 追跡型: プレイヤーを追跡
- **プレイヤーとの相互作用**: 踏んで倒すか、ダメージを受ける

### アイテムシステム実装完了
- **itemGenerator.js**: アイテムスプライト生成
- **Item.js**: アイテムクラスの実装
- **アイテムタイプ**:
  - コイン（回転アニメーション）
  - パワーアップキノコ（動く）
  - スター（跳ねる、無敵化）
  - ファイアフラワー（火の玉能力）
- **？ブロック連携**: ブロックを叩くとアイテム出現
- **スコアシステム**: アイテム取得でスコア加算

### ゴールシステム実装完了
- **goalGenerator.js**: ゴールスプライト生成
- **Goal.js**: ゴールクラスの実装
- **ゴールタイプ**:
  - 旗（草原・洞窟ステージ）
  - ゲート（城ステージ）
- **ゴール到達時の演出**:
  - 旗: 旗が下がり、プレイヤーがジャンプして喜ぶ
  - ゲート: プレイヤーがゲートに吸い込まれる
- **StageClearScene.js**: ステージクリア画面
  - スコア表示
  - タイムボーナス
  - 星のパーティクルエフェクト

### ゲームシステム完成
- **ゲームオーバー機能**: ライフがなくなるとゲームオーバー
- **落下死**: ステージから落ちるとライフが減る
- **ステージクリア**: ゴールに到達するとクリア画面へ
- **タイムボーナス**: 早くクリアするほどボーナス点

### サウンドシステム実装完了
- **soundGenerator.js**: Web Audio APIを使用した音生成
- **SoundManager.js**: サウンド管理クラス
- **実装した効果音**:
  - ジャンプ音
  - コイン取得音
  - パワーアップ音
  - 敵を踏む音
  - ダメージ音
  - ブロックヒット音
  - ゴール到達音
- **BGM**: 各ステージ用の簡易BGM（ループ再生）
  - 草原ステージ: 明るいメロディ
  - 洞窟ステージ: 神秘的なメロディ
  - 城ステージ: 緊張感のあるメロディ
- **音量制御**: SFXとBGMの個別制御可能
- **自動初期化**: ユーザーインタラクション後に音声開始

### 最終調整完了
- **settings.js**: ゲーム設定とセーブデータ管理
  - LocalStorageによる永続化
  - ハイスコア記録
  - 音量設定の保存
- **SettingsScene.js**: 設定画面の実装
  - 効果音/BGMのON/OFF
  - 音量調整スライダー
  - データリセット機能
- **UI改善**:
  - コイン数表示追加
  - タイマー表示追加
  - リアルタイム更新
- **視覚効果**:
  - 洞窟ステージの視界制限
  - グラデーション付き光源効果
- **README.md**: プロジェクト説明書作成

## プロジェクト完成
全ての主要機能の実装が完了しました。ゲームは完全にプレイ可能な状態です。
